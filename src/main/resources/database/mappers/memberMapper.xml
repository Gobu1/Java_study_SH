<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.iu.start.bankMembers.BankMembersDAO">

	<insert id="setAddFile" parameterType="BankMembersFileDTO">
		INSERT INTO MEMBERFILE VALUES
			(FILE_SEQ.NEXTVAL, #{fileName}, #{oriName}, #{userName})
	</insert>
		
	<select id="getLogin" parameterType="BankMembersDTO" resultType="BankMembersDTO">
	SELECT USERNAME, NAME FROM BANKMEMBERS WHERE USERNAME = #{userName} AND PASSWORD = #{password}
	</select>
	
	<select id="getSearchByID" parameterType="String" resultType="BankMembersDTO">
	SELECT * FROM BANKMEMBERS WHERE USERNAME LIKE '%'||#{search}||'%' 
	</select>
	
	<select id="setJoin" parameterType="BankMembersDTO" >
	INSERT INTO BANKMEMBERS VALUES (#{userName}, #{password}, #{name}, #{email}, #{phone})
	</select>
	
	<select id="getMyPage" parameterType="BankMembersDTO" resultMap="getMyPageResult">
	SELECT USERNAME, NAME, EMAIL, PHONE, BOOKNAME, FILENUM, FILENAME, ACCOUNTNUM, ACCOUNTDATE FROM BANKACCOUNT BA 
		RIGHT JOIN BANKBOOK BB USING (BOOKNUM)
    		RIGHT JOIN BANKMEMBERS BM USING (USERNAME)
    			LEFT JOIN MEMBERFILE MF USING (USERNAME)
    				WHERE USERNAME = #{userName}
	</select>
	
	<resultMap type="BankMembersDTO" id="getMyPageResult">
		<id column="USERNAME" property="userName"></id>
		<result column="NAME" property="name"></result>
		<result column="EMAIL" property="email"></result>
		<result column="PHONE" property="phone"></result>
		<association property="bankMembersFileDTOs" javaType="BankMembersFileDTO" >
			<id column="FILENUM" property="fileNum"></id>
			<result column="FILENAME" property="fileName"></result>
		</association>
		
		<collection property="bankAccountDTOs" javaType="List" ofType="BankAccountDTO">
			<id column="ACCOUNTNUM" property="accountNum"></id>
			<result column="ACCOUNTDATE" property="accountDate"></result>
			
			<association property="bankBookDTO" javaType="BankBookDTO">
				<result column="BOOKNAME" property="bookName"></result>
			</association>
		</collection>
		
	</resultMap>
	
	
	
</mapper>